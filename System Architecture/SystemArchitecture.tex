\documentclass[12pt, titlepage]{article}
\usepackage{xcolor} % for different colour comments

%% Comments
\newif\ifcomments\commentstrue

\ifcomments
\newcommand{\authornote}[3]{\textcolor{#1}{[#3 ---#2]}}
\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}}
\else
\newcommand{\authornote}[3]{}
\newcommand{\todo}[1]{}
\fi

\newcommand{\wss}[1]{\authornote{magenta}{SS}{#1}}
\newcommand{\ds}[1]{\authornote{blue}{DS}{#1}}

%% Graphics
\usepackage{float}
\usepackage{caption}
\usepackage{graphicx}
\graphicspath{ {Images/} }

\begin{document}

\title{Smart Waiter System Architecture} 
\author{Meraj Patel \#1137491 \\ Pavneet Jauhal \#1149311\\ Shan Perera \#1150394}
\date{\today}
\maketitle

\tableofcontents 

\listoffigures

\listoftables

\begin{table}[H]
\section*{Revision History}
\begin{tabular}{|c|c|}
\hline
\textbf{Date}  & \textbf{Comments} \\ \hline
October 9, 2015 &  first draft. \\ 
\hline
\end{tabular}
\caption{Revision History Table}
\end{table}

\section*{Template}
This document uses Volere Template for its organization.
\pagebreak

\section{Introduction}

\subsection{Purpose}

\subsection{Description}

\subsection{Scope}

\section{Overview}

\section{System Architecture}

\subsection{Overall Operation}
Below is a high level overview of Smart Waiter operation. The operation is decomposed into three components which is introduced in this section and will be thoroughly explained in the following sections. 


\includegraphics[width=150mm,scale=0.5]{OverallOperation.png}


\subsection{Order}
This component encompasses all operations needed to allow a user to place an order. This includes, user sign in and all operations till placing the order (top segment of operation diagram). The following components are described in detail in section 4 of this document: 

 \begin{enumerate}
  \item Menu Class Structure
  \item Barcode Scanning 
  \item Accounts
  \item Transactions
\end{enumerate}

\subsection{Database}

\subsection{Processing Order}

\section{Orders}

\subsection{Overview}
Below are key details of ordering component for Smart Waiter application. Detailed architecture review is provided.

\subsection{Menu Class Structure}
There are three primary classes used to hold all vital information regarding menu information. These are: MenuCategories, MenuItems and User. Each class purpose and its correlation with each other is explained below.

\subsubsection{MenuCategories Class}
This class purpose is to store menu category information of a restaurant menu. This entails category name, picture and a reference to category items. To do so, there are three main variables used within this class to hold this information: 

\begin{description}
  \item[categoryName:] Stores category name in the form of String
  \item[picURL:] Stores URL of category picture
  \item[categoryItems:] Stores an array of objects that reference MenuItems class
\end{description}


This class is instantiated and called upon when a user successfully scans a barcode. The JSON response acquired from the database is parsed, and information related to menu categories is stored appropriately within this class. The application uses this class to display category information when "Menu Categories" page is spawned (please see section 5.1.1 to view picture).

\subsubsection{MenuItems Class}
This class purpose is to store menu item information of a restaurant menu. This means, item name, price and description. Thee main variables are used within this class to hold this information.

\begin{description}
  \item[itemName:] Stores item name
  \item[itemPrice:] Stores item price
  \item[itemDetail:] Stores description of item
\end{description}

Objects of this class are instantiated from the MenuCategories class. By successfully scanning the barcode and parsing the JSON response, MenuItem objects are instantiated and used to save item details. These objects are held within categoryItems list seen in Menu Categories class. This application uses this class to display item information of a category when "Menu Items" page is spawned (please see section 5.1.2 to view picture). These objects are also used in reference to items the user would like to order. This is thoroughly discussed in the proceeding section.  

\subsubsection{User Class}
User class is used to store menu item a user would like to order. For now, there is only one important variable to consider: 

 \begin{description}
  \item[userItem:] an array that stores objects of MenuItems class. This is used to save menu items a user would like to order.
\end{description}

Only one object is instantiated through the life time of this application. This object represents the user cart of menu items he/she would like to order. This object is called upon when a user decides to add an item to their cart. When this occurs, a copy of the MenuItem object is saved within the userItem variables. This way, there is a list maintained to hold all item a user would like to order. When a user confirms and sends their order, the item information is extracted from userItem list, formatted into a JSON request and send back to the database for further processing. Having this class implemented allows extendibility in the future, as all vital information pertaining to a user can be stored within the class (for example, user settings).  


\subsection{Camera Structure}
There is one main function related to the Camera structure: onActivityResult. The camera is used to read QR codes, which contain the location of where the menu data is stored in relation to the current restaurant. The QR codes are read using an embedded version of the ZXing library. When the application starts, a ZXing specific variable (IntentIntegrator) is initialized, when the user clicks the "Scan QR Code" button on the first screen, the Camera is initialized. 

\subsubsection{Design Principles}
This component follows the Single Responsibility and the Information Hiding principle.  

\begin{description}
	\item[Single Responsibility:] The responsibility of this component is to capture and parse QR code data. If this component had to be changed, it would only affect the camera functionality of the application, and not other components like the menu or accounts.
	\item[Information Hiding:] The camera component is separate from every other component of this application. If any changes were to be made to the camera application, it will not affect the other components of the application. However, it is unlikely that there will be any changes applied to this component of the application.
\end{description}

\subsubsection{onActivityResult}
This function uses an integrated version of the ZXing library to scan QR codes. After the camera is initialized, the application waits for the user to pass a QR code, this is done by taking a picture of the QR code with the camera. The function onActivityResult is called as soon as a QR code is passed. It takes, as input a requestCode, resultCode, and the current intent: 

\begin{description}
  \item[requestCode:] Used to parse the QR code 
  \item[resultCode:] Used to parse the QR code 
  \item[intent:] Gives the current intent, used to parse the QR code
\end{description}

Using the given input, the function parses and gets the contents of the QR code that was passed to the function using the ZXing function parseActivityResult. The information stored in the QR code is then saved to a local variable to be used by the other components of the application.

\subsubsection{Module Decomposition}
Module: onActivityResult
\begin{description}
	\item[Secret:]How the QR code is parsed and read
	\item[Service:] Parses and gets the content of the QR code
\end{description}

\subsection{Accounts Structure}
There are 3 main classes related to the Accounts structure: User, Card, and Stripe. Accounts are used to associate a user identifier for transactions and for storing a user's credit card information securely. Credit card information transfer and storage uses Stripe API. This reduces the burden on the developers, since we can use an established API that follows the restrictions applied by credit card companies, and handles the secure transfer of sensitive information, rather than developing an efficient and secure system ourselves.

\subsubsection{Design Principles}
This component follows the Single Responsibility and the Information Hiding principle.  

\begin{description}
	\item[Single Responsibility:] The responsibility of this component is to securely store a user's credit card information for use in transactions. If this component had to be changed, it would only affect the camera functionality of the application, and not other components like the menu or accounts.
	\item[Information Hiding:] The camera component is separate from every other component of this application. If any changes were to be made to the camera application, it will not affect the other components of the application. However, it is unlikely that there will be any changes applied to this component of the application.
\end{description}
 
\subsection{Transactions Structure}

\section{User Interface Design}

\subsection{User Interface Design Overview}

\subsubsection{Menu Categories}
\includegraphics[width=80mm,scale=0.5]{MenuCategories.png}

\subsubsection{Menu Items}
\includegraphics[width=80mm,scale=0.5]{CategoryItems.png}

\subsubsection{Confirm Order}
\includegraphics[width=80mm,scale=0.5]{OrderSummary.png}

\subsection{User Interface Navigation Flow}

\includegraphics[width=180mm,scale=0.5]{UIProcess.png}

\subsection{Use Cases}

\subsubsection{Sign In Page}
\begin{center}
    \begin{tabular}{ | l | p{8cm} |}
    \hline
    User Input & System Response \\ \hline
    Enters correct user name and password & Application transitions to Barcode Scan page \\ \hline
    Enters incorrect user name and password & Toaster displayed reading "incorrect login, please try again" \\ \hline
    Enters incorrect user name & Toaster displayed reading "incorrect login, please try again" \\ \hline
    Enters incorrect password & Toaster displayed reading "incorrect login, please try again" \\ \hline
    Clicks "Skip Sign in" & Application  transitions to Barcode Scan page\\ \hline
    Clicks Back Button on phone & Application Quits \\
    \hline
    \end{tabular}
\end{center}


\subsubsection{Barcode Scan Page}
\begin{center}
    \begin{tabular}{ | l | p{10cm} |}
    \hline
    User Input & System Response \\ \hline
    Clicks Scan Barcode & Application transitions to camera so user can scan code. If successful, application will transition to menu page. Otherwise will return to scanning page and display a toaster reading, "please try again" \\ \hline
    Clicks back button on phone & Application transitions to Sign in Page \\
    \hline
    \end{tabular}
\end{center}

\subsubsection{Menu Categories Page}
\begin{center}
    \begin{tabular}{ | l | p{10cm} |}
    \hline
    User Input & System Response \\ \hline
    Clicks category & Application transitions Category Items \\ \hline
    Clicks back button on phone & Application transitions to Barcode Scan \\
    \hline
    \end{tabular}
\end{center}

\subsubsection{Category Items Page}
\begin{center}
    \begin{tabular}{ | l | p{10cm} |}
    \hline
    User Input & System Response \\ \hline
    Clicks Item & Application transitions to Customize Item \\ \hline
    Clicks back button on phone & Application transitions to Menu Categories \\
    \hline
    \end{tabular}
\end{center}


\subsubsection{Customize Item Page}
\begin{center}
    \begin{tabular}{ | l | p{8cm} |}
    \hline
    User Input & System Response \\ \hline
    Ticks check boxes & None \\ \hline
    Enters special instructions in input field & None \\ \hline
    Clicks "Add to Cart" & Transitions to cart page and populate list with item \\ \hline
    Clicks back button on phone & Application transitions to Menu items \\
    \hline
    \end{tabular}
\end{center}

\subsubsection{Cart Page}
\begin{center}
    \begin{tabular}{ | l | p{10cm} |}
    \hline
    User Input & System Response \\ \hline
 	Clicks "Delete" &  Deletes item from list\\ \hline
    Clicks "Submit Order" &  Transitions to payment page\\ \hline
    Clicks back button on phone & Application transitions to previous page \\
    \hline
    \end{tabular}
\end{center}

\subsubsection{Payment Page}

\begin{center}
    \begin{tabular}{ | l | p{7cm} |}
    \hline
    User Input & System Response \\ \hline
 	Input valid credit card and clicks "Process" & Transitions into Confirm Order page \\ \hline
    Input invalid credit card and clicks "Process" &  Toaster displayed reading "invalid credit card"\\ \hline
    Clicks back button on phone & Application transitions to previous Cart Page \\
    \hline
    \end{tabular}
\end{center}



\end{document}
